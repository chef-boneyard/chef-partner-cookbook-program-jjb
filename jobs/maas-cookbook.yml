- job:
    name: maas-cookbook
    project-type: freestyle
    description: 'verify that the maas-cookbook is in a state to push'
    properties:
      - github:
          url: https://github.com/chef-partners/maas.git
      - slack:
          notify-failure: True
          room: '#cookbook-partner-prog'
    scm:
      - git:
         url: https://github.com/chef-partners/maas.git
         wipe-workspace: false
         clean: true
         branches:
           - master
    builders:
      - check-markdown-files-are-there
      - shell: |
          #!/bin/bash
          echo "2.3.1" > .ruby-version
          echo "use_ruby" > .envrc
          direnv allow .
          eval "$(direnv export bash)"

          ruby --version

          gem install bundler -N
          gem install rake -N
          bundle
      - shell: |
          #!/bin/bash
          eval "$(direnv export bash)"
          bundle exec rake foodcritic .
      - shell: |
          #!/bin/bash
          eval "$(direnv export bash)"
          bundle exec rake spec .
      - shell: |
          #!/bin/bash
          eval "$(direnv export bash)"
          bundle exec rubocop .
    wrappers:
      - workspace-cleanup
      - release:
          keep-forever: false
    triggers:
      - timed: "@midnight"
